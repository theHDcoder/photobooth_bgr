<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Photobboth</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <!-- First, include the Webcam.js JavaScript Library -->
    <script type="text/javascript" src="webcam.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.768.0.js"></script>
    <script src="bucketsender.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.js"></script>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* body {
        background-color: #185c7e;
        height: 100vh;
      } */

      /*       
      .pagezero {
        font-family: "Poppins", sans-serif;
        color: #ecf0f1;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .login-container {
        background-color: #3498db;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        width: 300px;
      }

      .login-header {
        padding: 20px;
        text-align: center;
      }

      .login-form {
        padding: 20px;
        box-sizing: border-box;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
      }

      .form-group input {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border: 1px solid #bdc3c7;
        border-radius: 4px;
      }

      .login-button {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        border: none;
        border-radius: 4px;
        color: #ecf0f1;
        background-color: #2980b9;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .login-button:hover {
        background-color: #2c3e50;
      }

      .register-button {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        border: none;
        border-radius: 4px;
        color: #ecf0f1;
        background-color: transparent;
        cursor: pointer;
        transition: color 0.3s;
      }

      .register-button:hover {
        color: #3498db;
      } */
      .title {
        padding: 50px;
        margin: 3vw;
        text-align: center;
        color: white;
      }
      #bgsel {
        width: 34vw;
        height: 5vh;
        border-radius: 14px;
        font-size: 25pt;
      }
      #imagecanvas {
        position: absolute;
        top: 23vw;
        right: -6vw;
      }
      #hint {
        width: 100vw;
        position: absolute;
        height: 100vh;
        /* top: 1vw; */
        /* left: 7vw; */
      }
      .qrcontainer {
        width: 63vw;
        background: white;
        height: 47vh;
      }
      #qrcode {
        position: relative;
        top: 3vw;
        left: 4vw;
      }
    </style>
  </head>
  <body>
    <!-- <div class="title">
      <h1>Mercedes-Benz Photobooth</h1>
    </div> -->
    <!-- start of pagezero -->
    <div class="pagezero">
      <!-- <div class="login-container">
        <div class="login-header">
          <h2>Login</h2>
        </div>
        <div class="login-form">
          <div class="form-group">
            <label for="username">First Name:</label>
            <input
              type="text"
              class="form-control"
              id="firstname"
              placeholder="*required"
              aria-label="First name"
              autocomplete="off"
            />
          </div>
          <div class="form-group">
            <label for="lastname">Last Name:</label>
            <input
              type="text"
              class="form-control"
              id="lastname"
              placeholder="*required"
              aria-label="Last name"
              autocomplete="off"
            />
          </div>
          <div class="form-group">
            <label for="email">Email:</label>
            <input
              type="email"
              class="form-control"
              id="exampleInputEmail1"
              placeholder="optional"
              aria-describedby="emailHelp"
              autocomplete="off"
            />
          </div>
          <button class="login-button" type="button" onclick="submitButton()">
            Submit
          </button>
        </div>
      </div> -->

      <div class="container">
        <div class="login-box">
          <h2>demo_12.</h2>
          <form action="#">
            <div class="input-box">
              <input
                type="text"
                class="form-control"
                id="firstname"
                placeholder="*required"
                aria-label="First name"
                autocomplete="off"
              />
              <label>First Name :</label>
            </div>
            <div class="input-box">
              <input
                type="text"
                class="form-control"
                id="lastname"
                placeholder="*required"
                aria-label="Last name"
                autocomplete="off"
              />
              <label>Last Name :</label>
            </div>
            <div class="input-box">
              <input
                type="email"
                class="form-control"
                id="exampleInputEmail1"
                placeholder="optional"
                aria-describedby="emailHelp"
                autocomplete="off"
              />
              <label>Email :</label>
            </div>

            <button type="submit" class="btn" onclick="submitButton()">
              Start
            </button>
          </form>
        </div>
        <span style="--i: 0"></span>
        <span style="--i: 1"></span>
        <span style="--i: 2"></span>
        <span style="--i: 3"></span>
        <span style="--i: 4"></span>
        <span style="--i: 5"></span>
        <span style="--i: 6"></span>
        <span style="--i: 7"></span>
        <span style="--i: 8"></span>
        <span style="--i: 9"></span>
        <span style="--i: 10"></span>
        <span style="--i: 11"></span>
        <span style="--i: 12"></span>
        <span style="--i: 13"></span>
        <span style="--i: 14"></span>
        <span style="--i: 15"></span>
        <span style="--i: 16"></span>
        <span style="--i: 17"></span>
        <span style="--i: 18"></span>
        <span style="--i: 19"></span>
        <span style="--i: 20"></span>
        <span style="--i: 21"></span>
        <span style="--i: 22"></span>
        <span style="--i: 23"></span>
        <span style="--i: 24"></span>
        <span style="--i: 25"></span>
        <span style="--i: 26"></span>
        <span style="--i: 27"></span>
        <span style="--i: 28"></span>
        <span style="--i: 29"></span>
        <span style="--i: 30"></span>
        <span style="--i: 31"></span>
        <span style="--i: 32"></span>
        <span style="--i: 33"></span>
        <span style="--i: 34"></span>
        <span style="--i: 35"></span>
        <span style="--i: 36"></span>
        <span style="--i: 37"></span>
        <span style="--i: 38"></span>
        <span style="--i: 39"></span>
        <span style="--i: 40"></span>
        <span style="--i: 41"></span>
        <span style="--i: 42"></span>
        <span style="--i: 43"></span>
        <span style="--i: 44"></span>
        <span style="--i: 45"></span>
        <span style="--i: 46"></span>
        <span style="--i: 47"></span>
        <span style="--i: 48"></span>
        <span style="--i: 49"></span>
      </div>
    </div>
    <!-- end of page zero -->

    <!-- start of first page -->

    <!-- <div class="firstpage" style="display: none">
      <div
        id="carouselExampleControls"
        class="carousel slide"
        data-ride="carousel"
      >
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img
              class="d-block w-100"
              src="assets/image_mercedes0.jpg"
              alt="First slide"
            />
          </div>
          <div class="carousel-item">
            <img
              class="d-block w-100"
              src="assets/image_mercedes1.jpg"
              alt="Second slide"
            />
          </div>
          <div class="carousel-item">
            <img
              class="d-block w-100"
              src="assets/image_mercedes2.jpg"
              alt="Third slide"
            />
          </div>
        </div>
        <a
          id="prev"
          class="carousel-control-prev"
          href="#carouselExampleControls"
          role="button"
          data-slide="prev"
          onclick="prev(this.id)"
          style="visibility: hidden"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a
          id="next"
          class="carousel-control-next"
          href="#carouselExampleControls"
          role="button"
          data-slide="next"
          onclick="next(this.id)"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      <div class="selBtn" style="text-align: center; padding: 50px">
        <button
          id="bgsel"
          type="button"
          class="btn btn-primary"
          onclick="BgSelection()"
        >
          Select
        </button>
      </div>
    </div> -->
    <!-- end of first page -->

    <!-- second page -->
    <div class="secondpage" style="display: none">
      <div class="camstuff" style="display: flex; justify-content: center">
        <div id="my_camera" onclick="take_snapshot()"></div>
        <img
          id="hint"
          width="600"
          height="auto"
          onclick="take_snapshot()"
          src="hint.png"
          alt=""
        />
        <div id="results" style="display: none">
          <img id="snapimage" alt="" />
          <div class="cambtns" style="display: flex; justify-content: center">
            <button
              id="imgretake"
              onclick="retake()"
              type="button"
              class="btn btn-primary"
              style="width: 10rem; height: 4rem; margin: 3vw"
            >
              Retake
            </button>
            <button
              id="bgsel2"
              onclick="removebg()"
              type="button"
              class="btn btn-primary"
              style="width: 10rem; height: 4rem; margin: 3vw"
            >
              Select
            </button>
          </div>
        </div>
      </div>
      <div
        class="loader"
        style="
          display: none;

          color: #ecf0f1;
          margin-top: 2vw;
        "
      >
        <img src="assets/Loader.gif" alt="Loading..." />
        loading...
      </div>
    </div>
    <!-- end second page -->

    <!-- start 3rd page -->
    <div class="thirdpage" style="display: none">
      <div class="output">
        <canvas
          id="imageCanvas"
          width="1280"
          height="853"
          style="width: 60vw"
        ></canvas>
        <img
          id="bgimg"
          src="assets/image_mercedes1.jpg"
          alt=""
          style="display: none"
        />
        <img
          id="nobgimg"
          width="275"
          height="366"
          src=""
          alt=""
          style="display: none"
        />
        <img
          id="nobgremastered"
          width="275"
          height="366"
          src=""
          alt=""
          style="display: none"
        />
      </div>
      <button
        id="imgdwnld"
        type="button"
        class="btn btn-primary"
        style="margin-top: 4vw"
        onclick="download()"
      >
        Download
      </button>
      <button
        id="imgdwnld"
        type="button"
        class="btn btn-primary"
        style="margin-top: 4vw"
        onclick="ShareUsingQR()"
      >
        Share
      </button>
    </div>
    <div class="fourthpage" style="display: none">
      <div class="qrcontainer">
        <div id="qrcode"></div>
      </div>
    </div>
    <!-- end of 3rd page -->
    <script>
      var elem = document.documentElement;
      function submitButton() {
        if (
          document.getElementById("firstname").value == "" ||
          document.getElementById("lastname").value == ""
        ) {
          console.log("Please fill first & last name");
        } else {
          if (document.getElementById("exampleInputEmail1").value == "") {
            document.getElementById("exampleInputEmail1").value = "_";
          }
          if (elem.requestFullscreen) {
            elem.requestFullscreen();
          } else if (elem.webkitRequestFullscreen) {
            /* Safari */
            elem.webkitRequestFullscreen();
          } else if (elem.msRequestFullscreen) {
            /* IE11 */
            elem.msRequestFullscreen();
          }
          $(".pagezero").hide();
          // $(".firstpage").show();
          // $(".firstpage").hide();
          $(".secondpage").show();
          Webcam.set({
            width: 962,
            height: 1280,
            image_format: "jpeg",
            jpeg_quality: 90,
          });
          Webcam.set("constraints", {
            facingMode: "environment",
          });
          Webcam.attach("#my_camera");
        }
      }
      let randNum = Math.random() * 10000;
      // $(".carousel").carousel({
      //   interval: 9000000,
      // });
      // id = 0;
      // let randNum = Math.random() * 10000;
      // function prev(ele) {
      //   if (id == 1) {
      //     document.getElementById(ele).style.visibility = "hidden";
      //   }
      //   id--;
      //   document.getElementById("next").style.visibility = "visible";
      //   console.log(id, ele);
      // }
      // function next(ele) {
      //   if (id < 3) {
      //     id++;
      //     document.getElementById("prev").style.visibility = "visible";
      //   }
      //   if (id == 2) {
      //     document.getElementById(ele).style.visibility = "hidden";
      //   }
      //   console.log(id, ele);
      // }
      // function BgSelection() {
      //   localStorage.setItem("bgid", id);
      //   console.log(localStorage.getItem("bgid"));
      //   $(".firstpage").hide();
      //   $(".secondpage").show();
      //   Webcam.set({
      //     width: 962,
      //     height: 1280,
      //     image_format: "jpeg",
      //     jpeg_quality: 90,
      //   });
      //   Webcam.set("constraints", {
      //     facingMode: "environment",
      //   });
      //   Webcam.attach("#my_camera");
      //   // setTimeout(
      //   //   document
      //   //     .getElementById("my_camera")
      //   //     .appendChild(document.getElementById("hint")),
      //   //   1000
      //   // );
      // }
      function retake() {
        $(".secondpage").show();

        document.getElementById("my_camera").style.display = "block";
        $("#hint").show();
        document.getElementById("results").style.display = "none";
        Webcam.set({
          width: 962,
          height: 1280,
          image_format: "jpeg",
          jpeg_quality: 90,
        });
        Webcam.set("constraints", {
          facingMode: "environment",
        });
        Webcam.attach("#my_camera");
      }
      function take_snapshot() {
        // take snapshot and get image data
        Webcam.snap(function (data_uri) {
          // display results in page
          document.getElementById("results").style.display = "block";
          $("#snapimage").attr("src", data_uri);
        });
        Webcam.reset();
        $("#my_camera").hide();
        $("#hint").hide();
      }
      // removw background
      // import { removeBackground } from "./remove-background.js";
      var displayImage = document.getElementById("nobgimg");
      var snapImage = document.getElementById("snapimage");

      function dataURLtoFile(dataurl, filename) {
        var arr = dataurl.split(","),
          mime = arr[0].match(/:(.*?);/)[1],
          bstr = atob(arr[1]),
          n = bstr.length,
          u8arr = new Uint8Array(n);
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n);
        }
        return new File([u8arr], filename, { type: mime });
      }

      function removebg() {
        $(".secondpage").show();
        $(".camstuff").hide();
        $(".loader").show();
        //uncomment below
        var fileData = dataURLtoFile(snapImage.src, "imageName.jpg");
        // Multipart file
        const formData = new FormData();
        formData.append("image_file", fileData);
        formData.append("size", "auto");
        //previous
        const apiKey = "6Ku8rC7dmThmRfUP71Fy3yzm";

        //paid subs
        // const apiKey = "ZPAatNwnJvZgGo3iqaVSPzmk";

        fetch("https://api.remove.bg/v1.0/removebg", {
          method: "POST",
          headers: {
            "X-Api-Key": apiKey,
          },
          body: formData,
        })
          .then(function (reponse) {
            return reponse.blob();
          })
          .then(function (blob) {
            console.log(blob);
            const url = URL.createObjectURL(blob);
            displayImage.src = url;
            setTimeout(finalResult, 2000);
          })
          .catch();
        // setTimeout(finalResult, 3000);
      }
      function finalResult() {
        var canvas = document.getElementById("imageCanvas");
        var ctx = canvas.getContext("2d");
        // $("#bgimg").attr(
        //   "src",
        //   " assets/image_mercedes" + localStorage.getItem("bgid") + ".jpg"
        // );

        ctx.drawImage(document.getElementById("bgimg"), 0, 0);
        const imgd = document.getElementById("nobgimg");

        // if (localStorage.getItem("bgid") == 0) {
        //   destX = 358;
        //   destY = 280;
        //   ctx.drawImage(imgd, destX, destY, 196, 261);
        // } else if (localStorage.getItem("bgid") == 1) {
        //   destX = 420;
        //   destY = 250;
        //   ctx.drawImage(imgd, destX, destY, 236, 314);
        // } else if (localStorage.getItem("bgid") == 2) {
        //   destX = 420;
        //   destY = 250;
        //   ctx.drawImage(imgd, destX, destY, 236, 314);
        // }

        destX = 381;
        destY = 202;
        ctx.drawImage(imgd, destX, destY, 275, 366);
        addFileToBucket(
          "photobooth",
          dataURLtoFile(document.getElementById("imageCanvas").toDataURL()),
          document.getElementById("firstname").value +
            document.getElementById("lastname").value +
            document.getElementById("exampleInputEmail1").value +
            randNum +
            ".png"
        );

        //canvas.setAttribute("style", "transform:rotateZ(90deg)");
      }

      function finalRender() {
        var qrcode = new QRCode(document.getElementById("qrcode"), {
          text:
            "https://hdbuckettest.s3.ap-south-1.amazonaws.com/photobooth/" +
            document.getElementById("firstname").value +
            document.getElementById("lastname").value +
            document.getElementById("exampleInputEmail1").value +
            randNum +
            ".png",
          width: 500,
          height: 500,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H,
        });
        $(".secondpage").hide();
        $(".thirdpage").show();
      }
      function download() {
        var link = document.createElement("a");
        link.download =
          document.getElementById("firstname").value +
          document.getElementById("lastname").value +
          document.getElementById("exampleInputEmail1").value +
          randNum +
          ".png";
        link.href = document.getElementById("imageCanvas").toDataURL();
        link.click();
      }

      function ShareUsingQR() {
        $(".thirdpage").hide();
        $(".fourthpage").show();
      }
    </script>
  </body>
</html>
